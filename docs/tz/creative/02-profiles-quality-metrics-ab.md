# ТЗ (Creative) — Профили/схемы structured outputs и критерии качества (в т.ч. SLO/A/B)

Цель: подготовить финальные материалы для профилей генерации (`scene.v1`, `social.v1`, `combat.v1`, `epilogue.v1`): промпт‑пакеты, схемы structured outputs, критерии качества и методику A/B‑оценки, строго по актуальной официальной документации (с фиксацией ссылок и даты просмотра).

Требование «Источник истины»: в поставку включить раздел с URL официальной документации и датой/временем просмотра, подтверждающими применимость решений.

## Профили и промпты
- Профили: `scene.v1`, `social.v1`, `combat.v1`, `epilogue.v1`.
- Для каждого профиля предоставить:
  - System/assistant preamble (до 1200 символов), стиль, запреты.
  - 2–3 входных user‑frame (короткие примеры).
  - Guidance по длине/тону ответа.
- Параметры моделей (например, `temperature`, `top_p`) не задавать в креативной части — это зона Dev и только при явном подтверждении в официальной документации для используемой модели. Креатив фокусируется на содержании и структуре ответов.

## Схемы (JSON Schema)
- Для каждого профиля — финальная схема полей:
  - Scene: `title, summary, beats[], tags[]`.
  - Social: `topic, participants[], beats[], outcome`.
  - Combat: `situation, rounds[], outcome, tags[]`.
  - Epilogue: `tone, summary, aftermath[]`.
- Ограничения: типы, `minItems`, `minLength`, `additionalProperties: false`, черновик 2020‑12.

## Критерии качества (acceptance)
- Смысл: ответ релевантен промпту и контент‑паку; нет противоречий лору.
- Структура: валиден по схеме; `beats/rounds` — цельная последовательность (≥ 3).
- Стиль: лаконичность; отсутствие meta‑языка и запрещённого контента.

## A/B‑методика и SLO (креатив)
- A/B‑набор: 20–30 промптов на профиль, сравнение vX vs vY.
- Метрики: `accept_rate`, `lore_consistency_score (0–1)`, `brevity_score`, `tag_coverage`.
- Стартовые SLO: `accept_rate ≥ 0.9`, `lore_consistency_score ≥ 0.85` на A/B‑наборе.
- A/B‑отчёт: таблица (CSV) с промптами/метриками и выводы по выбору профиля.

## Реткон (гайд для редакторов)
- Когда использовать: несоответствие схеме/лору, избыточная длина, неподходящий тон.
- Приёмы: уточняющий фрейм, указание конкретного поля/ограничения, просьба «сжать до N слов», смена тона.
- Примеры до/после (≥ 5 кейсов).

## Что должна вернуть команда
- Тексты промптов: `docs/prompts/<profile>.md` для каждой роли (scene/social/combat/epilogue).
- Схемы (при необходимости правок): `contracts/jsonschema/*_response.schema.json`.
- A/B‑набор и результаты: `docs/ab/<date>-<profile>-vX-vY.yaml` и `docs/ab/results/<date>-<profile>.csv`.
- Реткон‑гайд: `docs/ab/retcon-guide.md`.
- «Источник истины»: `docs/ab/source-of-truth.md` — перечень URL и дата/время просмотра официальной документации, подтверждающей принятые решения.

## Приёмка
- Пакет промптов/прамбул и схемы поставлены (строгие, без лишних полей), критерии качества и A/B‑методика описаны.
- A/B‑отчёт по минимум одной итерации (vX vs vY) приложен.
- В комплекте присутствует раздел «Источник истины» (URL/дата).
